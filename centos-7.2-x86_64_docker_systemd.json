{
  "variables": {
    "src_image_name": "centos",
    "src_image_tag": "7.2.1511",
    "dst_image_name": "centos7.2.1511_systemd",
    "dst_image_tag": "0.1"
  },

  "builders": [
    {
      "type": "docker",
      "image": "{{user `src_image_name`}}:{{user `src_image_tag`}}",
      "commit": true,
      "run_command": [
        "--env=container docker",
        "-d",
        "-i",
        "-t",
        "--volume=/sys/fs/cgroup",
        "{{.Image}}",
        "/usr/sbin/init"
      ]
    }
  ],

  "provisioners":
  [
    {
      "type": "shell",
      "inline": ["yum -y install initscripts; yum clean all"]
    }
  ],

  "post-processors":
  [
    [
      {
        "type": "docker-tag",
        "repository": "gsebast/{{user `dst_image_name`}}",
        "tag": "{{user `dst_image_tag`}}"
      },
      {
        "type": "docker-push"
      }
    ]
  ]
}
