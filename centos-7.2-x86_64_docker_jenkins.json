{
  "variables": {
    "src_image_name": "centos7.2.1511_systemd",
    "src_image_tag": "0.1",
    "dst_image_name": "centos7.2.1511_systemd_jdk-8u91",
    "dst_image_tag": "0.1"
  },

  "builders": [
    {
      "type": "docker",
      "image": "{{user `src_image_name`}}:{{user `src_image_tag`}}",
      "commit": true,
      "run_command": [
        "-d",
        "-i",
        "-t",
        "{{.Image}}",
        "/usr/sbin/init"
      ]
    }
  ],

  "provisioners":
  [
    {
      "type": "chef-solo",
      "skip_install": "false",
      "prevent_sudo": "true",
      "cookbook_paths": ["/tmp/cookbooks"],
      "json": {
        "java": {
          "install_flavor": "oracle",
          "oracle": {
            "accept_oracle_download_terms": "true"
          },
          "jdk_version": "8",
          "jdk": {
            "8": {
              "x86_64": {
                "url": "http://download.oracle.com/otn-pub/java/jdk/8u91-b14/jdk-8u91-linux-x64.tar.gz",
                "checksum": "6f9b516addfc22907787896517e400a62f35e0de4a7b4d864b26b61dbe1b7552"
              }
            }
          }
        }
      },
      "run_list": [
        "recipe[java]"
      ]
    }
  ],

  "post-processors":
  [
    [
      {
        "type": "docker-tag",
        "repository": "gsebast/{{user `dst_image_name`}}",
        "tag": "{{user `dst_image_tag`}}"
      },
      {
        "type": "docker-push"
      }
    ]
  ]
}
